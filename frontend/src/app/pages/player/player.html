<div #container class="fixed inset-0 bg-black flex items-center justify-center z-50 overflow-hidden font-sans">
    <!-- Background Gradient Orb -->
    @if (!profile()) {
    <div
        class="absolute top-0 left-1/2 -translate-x-1/2 w-[50rem] h-[50rem] bg-brand-primary opacity-10 rounded-full pointer-events-none">
    </div>
    }

    <!-- 1. Loading State -->
    @if (loading()) {
    <div class="flex flex-col items-center space-y-8 animate-fade-in relative z-10">
        <div class="relative w-24 h-24">
            <div class="absolute inset-0 border-4 border-white/10 rounded-full"></div>
            <div
                class="absolute inset-0 border-4 border-brand-primary border-t-transparent rounded-full animate-spin-slow shadow-[0_0_20px_rgba(45,212,191,0.5)]">
            </div>
            <div class="absolute inset-4 bg-brand-primary/20 rounded-full animate-pulse-glow"></div>
        </div>
        <div class="text-brand-primary text-2xl font-bold tracking-[0.3em] uppercase animate-pulse">ADsPlay...</div>
    </div>
    }

    <!-- 2. Profile Selection -->
    @else if (!profile()) {
    <div
        class="w-full max-w-6xl px-4 flex flex-col items-center max-h-screen overflow-y-auto py-12 relative z-10 animate-fade-in">

        <div class="flex items-center gap-3 mb-10 text-brand-primary opacity-80">
            <svg class="w-8 h-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" />
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            <span class="text-2xl font-bold tracking-tight uppercase">ADSPLAY</span>
        </div>

        <h1 class="text-white text-4xl md:text-6xl font-black mb-16 tracking-tighter text-glow uppercase text-center">
            Chọn Màn Hình
        </h1>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 w-full">
            @for (p of allProfiles(); track p.id) {
            <button (click)="selectProfile(p)"
                class="p-8 rounded-3xl text-center group relative overflow-hidden hover:scale-105 transition-all duration-300 border border-white/10 hover:border-brand-primary/50 bg-white/5 hover:bg-white/10 shadow-2xl">
                <div
                    class="absolute inset-0 bg-gradient-to-br from-brand-primary/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500">
                </div>
                <h2
                    class="text-white text-3xl font-bold mb-4 group-hover:text-brand-primary transition-colors relative z-10 tracking-tight">
                    {{ p.name }}</h2>
                <div
                    class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-black/30 border border-white/5 text-gray-400 text-xs font-bold uppercase tracking-wider relative z-10">
                    <span class="w-2 h-2 rounded-full" [class.bg-brand-primary]="p.videoIds.length > 0"
                        [class.bg-red-500]="p.videoIds.length === 0"></span>
                    {{ p.videoIds.length }} CONTENT
                </div>
            </button>
            }
            @if (allProfiles().length === 0) {
            <div class="col-span-full text-center py-20 border border-dashed border-white/10 rounded-3xl bg-white/5">
                <p class="text-gray-400 text-xl font-light">Chưa có màn hình nào được tạo.</p>
                <a href="/admin"
                    class="mt-8 inline-flex items-center gap-2 px-6 py-3 rounded-xl bg-brand-primary text-white font-bold hover:bg-brand-primary-hover transition-colors shadow-lg shadow-brand-primary/20 uppercase tracking-widest text-sm">
                    Về Trang Quản Trị
                </a>
            </div>
            }
        </div>
    </div>
    }

    <!-- 3. Video Player (State: Profile Selected) -->
    @else {
    @if (!profile()?.videos || profile()?.videos?.length === 0) {
    <div class="flex flex-col items-center space-y-6 animate-fade-in relative z-10">
        <div class="text-white text-3xl font-bold tracking-tight">Màn hình chưa có nội dung</div>
        <button (click)="backToSelection()"
            class="px-8 py-3 rounded-full border border-white/20 text-white hover:bg-white/10 transition-colors uppercase tracking-widest text-sm font-bold">
            Quay Lại
        </button>
    </div>
    } @else {
    <div class="w-full h-full bg-black relative group/player flex items-center justify-center">
        <!-- object-contain is crucial for signage to avoid cropping info -->
        <video #videoPlayer [src]="currentVideoSrc()"
            class="max-w-full max-h-full w-auto h-auto object-contain shadow-2xl" playsinline (ended)="onVideoEnded()"
            (click)="toggleFullscreen()">
        </video>

        <!-- Overlay Controls (Hidden by default, hover to show) -->
        <div
            class="absolute top-6 left-6 opacity-0 group-hover/player:opacity-100 transition-opacity duration-300 z-[60] flex space-x-4">
            <button (click)="backToSelection()"
                class="bg-black/80 border border-white/10 text-white px-6 py-3 rounded-full flex items-center space-x-2 hover:bg-brand-primary hover:border-brand-primary transition-all text-sm font-bold uppercase tracking-wider shadow-lg">
                <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M10 19l-7-7m0 0l7-7m-7 7h18" />
                </svg>
                <span>Quay Lại</span>
            </button>
            <button (click)="toggleFullscreen()"
                class="bg-black/80 border border-white/10 text-white p-3 rounded-full hover:bg-brand-primary hover:border-brand-primary transition-all shadow-lg"
                title="Toàn Màn Hình">
                <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4" />
                </svg>
            </button>
        </div>
    </div>

    <!-- Fullscreen Request Overlay (Kiosk Mode) -->
    @if (!isFullscreen()) {
    <div (click)="toggleFullscreen()"
        class="absolute inset-0 z-50 bg-black/80 backdrop-blur-sm flex flex-col items-center justify-center cursor-pointer animate-fade-in group/overlay">
        <div
            class="w-24 h-24 rounded-full bg-brand-primary/10 border-2 border-brand-primary flex items-center justify-center mb-6 group-hover/overlay:scale-110 transition-transform duration-300 shadow-[0_0_30px_rgba(45,212,191,0.3)]">
            <svg class="w-10 h-10 text-brand-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4" />
            </svg>
        </div>
        <h2 class="text-white text-2xl font-bold uppercase tracking-[0.2em] animate-pulse">Chạm Để Phóng To</h2>
        <p class="text-slate-400 mt-2 text-sm">Chế độ hiển thị toàn màn hình</p>
    </div>
    }
    }
    }
</div>